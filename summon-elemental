// Dragonbane - Summon Elemental
// Uses Foundry Summons 2 and Transient Compendium Actor Library Modules
// Create four summon macros (Summon Gnome, Summon Salamander, etc) using this code.
// Replace the actor UUIDs in the code with the UUIDs for the appropriate elementals and power levels.
// Give the caster's player Limited ownership of the macro and Owner ownership of the elementals (create copies in a Summons folder if you want to keep them separated).
// Make sure the caster's summon spells have "n/a" in the damage fields so Automated Animations will trigger.
// Create an Automated Animation entry for the spell name (On Token is fine). Give it an animation and sound, and then add the macro to the AA entry (When to Play: Concurrent with Animation is usually fine).

const CREATURE_UUIDS = {
  1: "Actor.uxwdYZxZewJNYSJj", // Elemental Power Level 1 UUID
  2: "Actor.lMHpFrQjAWqx3dIT",  // Elemental Power Level 2 UUID
  3: "Actor.CcOA6lwVZuW64nCr" / / Elemental Power Level 3 UUID
};

// Get power level of spell
function getPowerLevel() {
  const messages = game.messages.contents.slice(-5);
  
  for (let i = messages.length - 1; i >= 0; i--) {
    const message = messages[i];

    const match = message.content.match(/data-power-level="(\d+)"/);
    
    if (match) {
      const level = parseInt(match[1]);
      if (level >= 1 && level <= 3) {
        return level;
      }
    }
  }
  
  return 1; // Default to Power Level 1
}

// Summon Elemental
const powerLevel = getPowerLevel();
const uuid = CREATURE_UUIDS[powerLevel];

if (foundrySummons && uuid) {
  foundrySummons.pick({ uuid: uuid });
}
